## æ•…äº‹èƒŒæ™¯

---

æˆ‘ä»¬å…¬å¸æ˜¯ä¸€å®¶**ä¼ ç»Ÿç”µåŠ›ä¼ä¸š**ï¼Œä¸»è¦åš**å‚¨èƒ½ç³»ç»Ÿï¼ˆESSï¼‰**ã€‚å‚¨èƒ½åˆ†ä¸¤ç§ï¼š**å¤§å‚¨**å’Œ**å°å‚¨**ï¼ŒåŒºåˆ«å…¶å®å°±æ˜¯**è§„æ¨¡å¤§å°**ã€‚å¤§å‚¨å¹¶å‘é‡é«˜ï¼Œå°å‚¨ç›¸å¯¹è½»é‡ã€‚

å¤§å‚¨ç°åœ¨è·‘çš„æ˜¯**Java å…¨å®¶æ¡¶ + åˆ†å¸ƒå¼æ¶æ„**ï¼Œåœ¨**åˆ€ç‰‡æœåŠ¡å™¨**ä¸Šï¼Œè¿™å¥—å¯¹å¤§å‚¨æ²¡é—®é¢˜ï¼Œä½†æ”¾åˆ°å°å‚¨ä¸Šå°±æ˜¾å¾—**å¤ªç¬¨é‡**äº†ã€‚æ›´å…³é”®çš„æ˜¯ï¼ŒJava åœ¨å›½äº§ç³»ç»Ÿä¸Šçš„å…¼å®¹æ€§ä¹Ÿä¸ç®—å¥½ï¼Œæœ‰æ—¶å€™è¿˜ä¼šè¸©å‘ã€‚
æ‰€ä»¥ï¼Œå…¬å¸å†³å®šæä¸€å¥—**è½¯ç¡¬ä»¶ä¸€ä½“çš„å°å‚¨ç³»ç»Ÿ**ï¼Œæ—¢è½»é‡åˆèƒ½çµæ´»é€‚é…å›½äº§ç³»ç»Ÿã€‚

ç¡¬ä»¶è¿™è¾¹ï¼Œç”¨çš„æ˜¯**ç‘èŠ¯å¾®çš„æ¿å­**ï¼Œç¡¬ä»¶å·¥ç¨‹å¸ˆè‡ªå·±ç”»çš„ï¼Œç³»ç»Ÿä¹Ÿæ˜¯æˆ‘ä»¬åŸºäº Linux ç§»æ¤çš„ã€‚

è½¯ä»¶è¿™å—ï¼Œåˆ†ä¸¤éƒ¨åˆ†ï¼š
- **C++**ï¼šä¸»è¦è´Ÿè´£**æ•°æ®é‡‡é›†**å’Œ**æ•°æ®ä¸‹å‘**ï¼Œç›´æ¥è·Ÿç¡¬ä»¶æ‰“äº¤é“ã€‚åƒé‚£äº›**Modbusã€104ã€61850 åè®®**ï¼Œéƒ½æ˜¯å…¬å¸å…ƒè€å½“å¹´å†™çš„â€œç¥–ä¼ ä»£ç â€ï¼Œæˆ‘ä»¬ç°åœ¨ä¹Ÿå°±ç»´æŠ¤ç»´æŠ¤ã€‚ä½†ä¸å¾—ä¸è¯´ï¼Œ**åº•å±‚è¿˜æ˜¯é¦™**ã€‚
- **Rust**ï¼šç”¨æ¥åš**Web æœåŠ¡**ï¼Œå¤„ç†é‡‡é›†çš„æ•°æ®ï¼Œç„¶åç»™å‰ç«¯å±•ç¤ºã€‚

ä½ å¯èƒ½ä¼šé—®ï¼š**ä¸ºå•¥ä¸ç”¨ C++ æˆ– Goï¼Ÿ**

å…¶å®ï¼Œç”¨ Go å¯èƒ½æ›´åˆé€‚ï¼Œè½»é‡ã€ç”Ÿæ€ä¹Ÿå¥½ï¼Œå…¬å¸åç«¯è¯­è¨€ä¹Ÿä¸¥é‡è¿‡å‰©ï¼ŒJava å¤ªç¬¨é‡äº†ï¼Œ è¿˜æœ‰è£…ä¸ªè™šæ‹Ÿæœºï¼Œè€Œä¸”å¯¹å›½äº§ç³»ç»Ÿå…¼å®¹æ€§ä¹Ÿä¸æ˜¯å¾ˆå¥½ã€‚ä½†æœ€åé€‰ Rustï¼Œå¤šå°‘å¸¦ç‚¹**ä¸ªäººä¸»ä¹‰çš„å› ç´ **ğŸ˜‚ã€‚è¯´å®è¯ï¼Œæˆ‘è‡ªå·±ä¹Ÿå–œæ¬¢ Rustï¼ŒRuståç«¯ä¸»è¦æ˜¯æˆ‘è·Ÿæˆ‘çš„é¢†å¯¼åœ¨å†™ã€‚ä½†ç«™åœ¨å…¬å¸è§’åº¦ï¼Œè¿™å†³å®šæˆ‘æœ‰ç‚¹ä¸æ•¢è‹ŸåŒï¼š**Rust æ‹›äººå¤ªéš¾ï¼Œå¯¹ä¸ªäººæ¥è¯´ä¸å¯æ›¿ä»£æ€§éå¸¸é«˜**ã€‚å…³é”®è¿™å†™rustçš„å‡ºå»ä¹Ÿä¸åƒé¦™å•Šï¼Œgoçš„å°±ä¸šç›¸å¯¹rustè¿˜æ˜¯é«˜å¾ˆå¤šäº†ã€‚

å‰ç«¯è¿™å—æ›´æœ‰æ„æ€ã€‚ä¸€å¼€å§‹ç”¨çš„æ˜¯**Chrome + Vue**ï¼Œåæ¥æ¢æˆäº†**Flutter**ã€‚ä¸ºå•¥æ¢ï¼Ÿå› ä¸º Chrome **å¤ªåƒå†…å­˜**äº†ï¼Œè·‘å‡ å¤©å°±**å¡æ­»**ï¼Œä¸ç¨³å®šå¾—å¾ˆã€‚é€‰ Flutter æ—¶ï¼Œæˆ‘ä»¬è¿˜è€ƒè™‘è¿‡ **Qt**ï¼ŒQt å¯¹ Linux çš„å…¼å®¹æ€§ç¡®å®å¥½ï¼Œä½†**å¼€å‘é—¨æ§›é«˜**ã€‚å…¬å¸å‰ç«¯ 5 ä¸ªäººï¼Œæœ¬æ¥å°±**ä¸¥é‡è¿‡å‰©**ï¼Œæˆ‘ä¹Ÿæ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå˜¿å˜¿ã€‚Flutter ä¸Šæ‰‹å¿«ï¼ŒUIåº“ç”Ÿæ€å¥½ã€‚äºæ˜¯è¿™æ´»å°±ä¸¢ç»™äº†æˆ‘ä»¬ã€‚æˆ‘å½“æ—¶çš„æƒ³æ³•å¾ˆç®€å•ï¼š**æœ‰é¡¹ç›®å¹²ï¼Œå°±ä¸ç”¨æ‹…å¿ƒè£å‘˜ï¼Œç¾æ»‹æ»‹**ã€‚

Flutter çš„å‘è¿˜ä¸å°‘ï¼Œä¸‹æ¬¡å†èŠå§ã€‚

æ—©æœŸçš„åŠŸèƒ½å¾ˆå°‘ï¼Œç‚¹å·å†å²ç­‰ä¸šåŠ¡æ•°æ®éƒ½æ˜¯ç”¨çš„æ–‡ä»¶æ¥åšï¼Œ webæ¡†æ¶ä½¿ç”¨çš„æ˜¯ `actix-web` ç„¶ååœ¨åŠ ä¸€äº›è¾…åŠ©åº“ json thiserror http log ç­‰, æˆ‘ä»¬åœ¨ `macos` ä¸Šå¼€å‘ å¼€å‘å®Œæˆåï¼Œéœ€è¦åœ¨å¼€å‘ç‰ˆä¸Šç¼–è¯‘ï¼Œå°±è¿™æ ·æˆ‘ä»¬ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œå½“æ—¶äº¤å‰ç¼–è¯‘å…¶å®æˆ‘ä»¬ä¹ŸçŸ¥é“ï¼Œå°±æ˜¯è§‰å¾—è¿™ç©æ„å¤ªé«˜ç«¯äº†ï¼Œæ²¡æ•¢å»ç¢°ï¼Œæ¯æ¬¡æˆ‘ä»¬åœ¨æ¿å­ä¸Šç¼–è¯‘æ˜¯çœŸçš„æ…¢ï¼Œ åœ¨åŠ ä¸Šåé¢å› ä¸ºæˆ‘ä»¬è¦åšè‡ªåŠ¨è¿ç»´CI/CDä¸å¾—ä¸å»ç ”ç©¶äº†ã€‚

**ä»€ä¹ˆæ˜¯äº¤å‰ç¼–è¯‘**
äº¤å‰ç¼–è¯‘ï¼ˆCross Compilationï¼‰æŒ‡çš„æ˜¯**åœ¨ä¸€ç§å¹³å°ä¸Šç¼–è¯‘ç¨‹åºï¼Œä½†ç›®æ ‡ç¨‹åºè¿è¡Œåœ¨å¦ä¸€ç§å¹³å°ä¸Š** å¯¹èƒƒå£æˆ‘ä»¬åœ¨ `macos` ä¸Šå¼€å‘è¦ç¼–è¯‘æˆlinux å¯æ‰§è¡Œæ–‡ä»¶

**ä¸ºä»€ä¹ˆè¦äº¤å‰ç¼–è¯‘å‘¢**
1. **ç›®æ ‡è®¾å¤‡ç®—åŠ›å¼±**ï¼šæ¯”å¦‚åµŒå…¥å¼æ¿å­ï¼ˆARMï¼‰æ€§èƒ½ä¸å¤Ÿï¼Œç›´æ¥ç¼–è¯‘æ…¢
2. **ç›®æ ‡è®¾å¤‡æ²¡æœ‰å®Œæ•´å¼€å‘ç¯å¢ƒ**ï¼šå°å‹ Linux ç³»ç»Ÿã€IoT è®¾å¤‡ã€è·¯ç”±å™¨ã€‚
3. **åœ¨ CI/CD æˆ–å¤§æœåŠ¡å™¨ä¸Šç»Ÿä¸€ç¼–è¯‘**ï¼šç»Ÿä¸€äº§ç‰©ï¼Œæ–¹ä¾¿éƒ¨ç½²ã€‚

**Rustè‡ªå¸¦çš„äº¤å‰ç¼–è¯‘å·¥å…·**

	1.äº¤å‰ç¼–è¯‘å‘½ä»¤

```bash
 hello git:(master) âœ— cargo build --target x86_64-unknown-netbsd                              
   Compiling cfg-if v1.0.3
   Compiling pin-project-lite v0.2.16
   Compiling futures-core v0.3.31
   Compiling libc v0.2.175
   Compiling serde v1.0.219
   Compiling crossbeam-utils v0.8.21
   Compiling libm v0.2.15
   Compiling stable_deref_trait v1.2.0
   Compiling typenum v1.18.0
   Compiling num-traits v0.2.19
   Compiling parking v2.2.1
   Compiling zerofrom v0.1.6
error[E0463]: can't find crate for `core`
  |
  = note: the `x86_64-unknown-netbsd` target may not be installed
  = help: consider downloading the target with `rustup target add x86_64-unknown-netbsd`
```

	2. çœ‹é”™è¯¯è®©æˆ‘æ·»åŠ è¿™ä¸ª, æ‰§è¡Œè¿™å¥è¯ä¹‹å‰ï¼Œæˆ‘ä»¬çœ‹çœ‹ Rust æ”¯æŒå“ªäº›å¹³å°äº¤å‰ç¼–è¯‘

```bash
tenant-system git:(master) âœ— rustup target list                                                       
aarch64-apple-darwin (installed)
aarch64-apple-ios
aarch64-apple-ios-macabi
aarch64-apple-ios-sim
aarch64-linux-android (installed)
aarch64-pc-windows-gnullvm
aarch64-pc-windows-msvc
aarch64-unknown-fuchsia
aarch64-unknown-linux-gnu (installed)
aarch64-unknown-linux-musl
aarch64-unknown-linux-ohos
aarch64-unknown-none
aarch64-unknown-none-softfloat
aarch64-unknown-uefi
arm-linux-androideabi
arm-unknown-linux-gnueabi
arm-unknown-linux-gnueabihf
arm-unknown-linux-musleabi
arm-unknown-linux-musleabihf
...
```

	3. æ·»åŠ å®Œæˆåæˆ‘ä»¬ç»§ç»­æ‰§è¡Œ

```bash
hello git:(master) âœ— rustup target add x86_64-unknown-linux-gnu     
info: component 'rust-std' for target 'x86_64-unknown-linux-gnu' is up to date

hello git:(master) âœ— cargo build --target x86_64-unknown-linux-gnu     
   Compiling hello v0.1.0 (/Users/rongts/hello)
error: linking with `cc` failed: exit status: 1
  |
  = note:  "cc" "-m64" "/var/folders/vk/hj12b3d9529c3xwt399dlc480000gn/T/rustcPoDzpS/symbols.o" "<7 object files omitted>" "-Wl,--as-needed" "-Wl,-Bstatic" "<sysroot>/lib/rustlib/x86_64-unknown-linux-gnu/lib/{libstd-*,libpanic_unwind-*,libobject-*,libmemchr-*,libaddr2line-*,libgimli-*,librustc_demangle-*,libstd_detect-*,libhashbrown-*,librustc_std_workspace_alloc-*,libminiz_oxide-*,libadler2-*,libunwind-*,libcfg_if-*,liblibc-*,librustc_std_workspace_core-*,liballoc-*,libcore-*,libcompiler_builtins-*}.rlib" "-Wl,-Bdynamic" "-lgcc_s" "-lutil" "-lrt" "-lpthread" "-lm" "-ldl" "-lc" "-L" "/var/folders/vk/hj12b3d9529c3xwt399dlc480000gn/T/rustcPoDzpS/raw-dylibs" "-Wl,--eh-frame-hdr" "-Wl,-z,noexecstack" "-L" "<sysroot>/lib/rustlib/x86_64-unknown-linux-gnu/lib" "-o" "/Users/rongts/hello/target/x86_64-unknown-linux-gnu/debug/deps/hello-807003dda5d5fb85" "-Wl,--gc-sections" "-pie" "-Wl,-z,relro,-z,now" "-nodefaultlibs"
  = note: some arguments are omitted. use `--verbose` to show all linker arguments
  = note: clang: warning: argument unused during compilation: '-pie' [-Wunused-command-line-argument]
          ld: unknown options: --as-needed -Bstatic -Bdynamic --eh-frame-hdr -z --gc-sections -z -z 
          clang: error: linker command failed with exit code 1 (use -v to see invocation)
          

error: could not compile `hello` (bin "hello") due to 1 previous error
```

ç‰¹å–µçš„æœ‰æŠ¥é”™ï¼ï¼ï¼

è¿™ä¸ªé”™è¯¯çš„æ ¸å¿ƒåŸå› æ˜¯ï¼š**ä½ åœ¨ macOS ä¸Šäº¤å‰ç¼–è¯‘ x86_64-unknown-linux-gnu ç›®æ ‡æ—¶ï¼ŒRust èƒ½ç¼–è¯‘ .o æ–‡ä»¶ï¼Œä½†æœ€åä¸€æ­¥ link å¤±è´¥ï¼Œå› ä¸º macOS ç³»ç»Ÿé»˜è®¤çš„ ccï¼ˆå…¶å®æ˜¯ clangï¼‰ä¸ä¼šæ”¯æŒ Linux çš„é“¾æ¥é€‰é¡¹ã€‚**

**ä¸ºä»€ä¹ˆä¼šæŠ¥**Â inking with cc failed**

Rust ç¼–è¯‘å™¨èƒ½ç”Ÿæˆç›®æ ‡å¹³å°ï¼ˆLinux x86_64ï¼‰çš„ç›®æ ‡ä»£ç ï¼Œä½†é“¾æ¥é˜¶æ®µéœ€è¦ï¼š

- Linux çš„é“¾æ¥å™¨ï¼ˆldï¼‰
- Linux çš„æ ‡å‡†åº“ï¼ˆglibcï¼‰
- å¯¹åº”çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾

ä½†æ˜¯ macOS ä¸Šåªæœ‰ Darwin å¹³å°çš„å·¥å…·é“¾ï¼Œclang ä¸è®¤è¯† --as-neededã€-zã€--gc-sections ç­‰ GNU ld çš„å‚æ•°ï¼Œç›´æ¥æŠ¥é”™ã€‚

	4. é—®é¢˜ææ¸…æ¥šäº†ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆé…ç½®å…¶ä»–ç¼–è¯‘å™¨å‘¢ï¼Œè€Œä¸”ç¼–è¯‘å™¨æ€ä¹ˆé€‰æ‹©è·Ÿä¸‹è½½å‘¢

`macos mç³»åˆ—`ï¼Œ ä½¿ç”¨ brew å°±å¯ä»¥å®‰è£…ï¼Œæˆ‘ä½¿ç”¨ x86 aarch64 éƒ½æ˜¯å¯ä»¥ç›´æ¥ç”¨çš„
```bash
hello git:(master) âœ— brew install x86-linux-gnu-gcc
Warning: No available formula with the name "x86-linux-gnu-gcc". Did you mean x86_64-linux-gnu-binutils?
==> Searching for similarly named formulae and casks...
==> Formulae
x86_64-linux-gnu-binutils âœ”

To install x86_64-linux-gnu-binutils âœ”, run:
  brew install x86_64-linux-gnu-binutils âœ”
  
# æ ¹æ®é”™è¯¯æç¤ºï¼Œæˆ‘ä»¬æ‰§è¡Œ brew install x86_64-linux-gnu-gcc

hello git:(master) brew install x86_64-linux-gnu-gcc
hello git:(master) âœ— ls -al  /opt/homebrew/bin/x86_64-linux-gnu-gcc                
lrwxr-xr-x  1 rongts  admin  66  8 15  2024 /opt/homebrew/bin/x86_64-linux-gnu-gcc -> ../Cellar/x86_64-unknown-linux-gnu/13.2.0/bin/x86_64-linux-gnu-gcc

```

å…¶ä»–å¹³å°æˆ–è€…æ²¡æœ‰æ‰¾åˆ° ç¼–è¯‘å™¨æ€ä¹ˆåŠå‘¢ï¼Ÿ
å¯ä»¥ä½¿ç”¨ docker qemu [corss](https://github.com/cross-rs/cross) æŠ€æœ¯ ï¼Œæˆ–è€…ä½¿ç”¨ [cargo_buildzig](https://github.com/rust-cross/cargo-zigbuild) å°±æ˜¯zigæ•´çš„ä¸€å¥—äº¤å‰ç¼–è¯‘å·¥å…·,å¯ä»¥æ›¿ä»£ x86_64-linux-gnu-gcc éå¸¸å“‡å¡ï¼Œä¸ç”¨å†å»ä¸‹è½½å„ç§ç¼–è¯‘å™¨äº†ï¼Œ[è¯¦ç»†æ–‡æ¡£](https://rustprojectprimer.com/building/cross.html)

	5. å¼€å§‹ç¼–è¯‘é…ç½®ç¼–è¯‘
```bash
## åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å»ºç«‹é…ç½®æ–‡ä»¶ .cargo/config.toml
hello git:(master) cat <<EOF >> .cargo/config.toml
[target.aarch64-unknown-linux-gnu]
linker = "aarch64-linux-gnu-gcc"
[target.x86_64-unknown-linux-gnu]
linker = "x86_64-linux-gnu-gcc"
EOF

hello git:(master) âœ— cargo build --target x86_64-unknown-linux-gnu
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.03s
```
æˆåŠŸäº† ğŸ… MacOSæ˜¯æœ€å¥½çš„å¼€å‘å¹³å°ï¼ŒğŸ˜„è¿™å°±è§£å†³äº†

**å¥½æ™¯ä¸é•¿**

éšç€ä¸šåŠ¡çš„è¿­ä»£ï¼Œæ–°å¢äº†`mysql mqtt kafka websocket influxdb ` ç»Ÿç»Ÿéƒ½æ¥äº†ï¼Œæœ‰ä¸€äº›åº“ä¾èµ–äº† `openssl` ï¼Œè¿™é¸Ÿåº“æ˜¯cè¯­è¨€å¼€å‘çš„ï¼Œrust å¯¹ä»–åšäº†ä¸€å±‚æ¥å£åŒ…è£…ä½¿ç”¨ï¼Œå½“æˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å€™ä¼šä½¿ç”¨
`pkg-config` åšæ£€æŸ¥ï¼Œå‰æœŸæˆ‘ä»¬è¢«è¿™ä¸ªå›°æ‰°äº†å¾ˆä¹…ï¼Œ åé¢å‘ç°åœ¨ Rust ä¸­ï¼Œæœ‰ä¸€ç§**vendored æ¨¡å¼**ä¸»è¦ç”¨äº **Rust æ„å»ºä¾èµ–çš„ C/C++ åº“**ï¼ˆé€šå¸¸æ˜¯ opensslã€libssh2ã€ring ç­‰ï¼‰ï¼Œæˆ–è€…åœ¨ä½¿ç”¨ cargo çš„æ—¶å€™æƒ³æŠŠæ‰€æœ‰ä¾èµ–â€œæœ¬åœ°åŒ–â€ï¼Œä¸ä¾èµ–ç³»ç»Ÿåº“æˆ–å¤–éƒ¨ç½‘ç»œã€‚

æ¯”å¦‚openssl æˆ‘ä»¬å¯ä»¥ä½¿ç”¨

```
openssl-sys = { version = "0.9.90", features = ["vendored"] }
```

è¿™æ ·äº¤å‰ç¼–è¯‘ä¹Ÿèƒ½æˆåŠŸã€‚ä½†æ˜¯è¿™æ ·åŒ…ä¼šå¾ˆå¤§ï¼Œå› ä¸ºä»–ä¼šæŠŠè¿™ä¸ªåŒ…æ‰“åŒ…è¿›å»ï¼Œä¸ä½¿ç”¨å®¿ä¸»æœºçš„ `openssl` ï¼Œ

`vendored` ä¹Ÿä¸æ˜¯æ‰€æœ‰çš„å¹³å°éƒ½èƒ½ç¼–è¯‘æˆåŠŸï¼Œæˆ‘å°±é‡åˆ° `ubuntu` ä¸­ç¼–è¯‘ `armv7` ç¼–è¯‘æŠ¥é”™ï¼Œå½“ç„¶æˆ‘æ˜¯ä½¿ç”¨çš„ `zig cc` æ¥ç¼–è¯‘çš„ï¼Œå…¶ä»–å¹³å° `zig cc` éƒ½èƒ½æˆåŠŸ


**æœ€å¥½çš„è§£å†³æ–¹æ¡ˆ ä½¿ç”¨ [cross](https://github.com/cross-rs/cross)

cross æ˜¯ä¸€ä¸ªç”± Rust ç¤¾åŒºå¼€å‘çš„å·¥å…·ï¼Œæ—¨åœ¨ç®€åŒ– Rust é¡¹ç›®çš„äº¤å‰ç¼–è¯‘è¿‡ç¨‹ã€‚å®ƒé€šè¿‡ Docker æˆ– Podman å®¹å™¨æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ„å»ºç¯å¢ƒï¼Œä½¿å¾—åœ¨ä¸åŒå¹³å°ä¹‹é—´æ„å»º Rust é¡¹ç›®å˜å¾—æ›´åŠ å®¹æ˜“

è¿™ä¸ªå·¥å…·å®Œç¾çš„è§£å†³äº†æˆ‘ä»¬çš„é—®é¢˜ï¼Œåœ¨äº¤å‰ç¼–è¯‘çš„æ—¶å€™ï¼Œæå–å®‰è£…ä¸€äº›åŒ…ï¼Œæ¯”å¦‚æˆ‘ç¼–è¯‘ x84 å¹³å°æˆ‘ç¼ºå°‘è¿™ä¸ªå¹³å°çš„ openssl ï¼Œæˆ‘å¯ä»¥åœ¨ç¼–è¯‘å™¨æŠŠ openssl åŒ…å®‰è£…å¥½ã€‚

ğŸ§© é…ç½®é€‰é¡¹
cross æä¾›äº†å¤šç§é…ç½®æ–¹å¼ï¼Œä»¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚ï¼š
- åœ¨ Cross.toml ä¸­é…ç½®ï¼š
```bash
[build]
build-std = false # do not build the std library. has precedence over xargo
xargo = true # enable the use of xargo by default
zig = false # do not use zig cc for the builds
default-target = "x86_64-unknown-linux-gnu" # use this target if none is 
pre-build = [ # additional commands to run prior to building the package
"dpkg --add-architecture $CROSS_DEB_ARCH",
"apt-get update && apt-get --assume-yes install libssl-dev:$CROSS_DEB_ARCH"
]
```

- ä½¿ç”¨ Cross.toml æ–‡ä»¶ï¼š
    åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º Cross.toml æ–‡ä»¶ï¼Œè¿›è¡Œé…ç½®

**ğŸ§ªå®éªŒæ­¥éª¤
1. åœ¨ macos m1 ä¸­å¼€å§‹ç¼–è¯‘

```bash
 hello git:(master) âœ— cross build --target x86_64-unknown-linux-gnu                         
[cross] warning: found unused key(s) in Cross configuration:
 > build.zig
[+] Building 1.6s (2/2) FINISHED                                                                                                                              docker:orbstack
 => [internal] load build definition from Dockerfile.x86_64-unknown-linux-gnu-custom                                                                                     0.0s
 => => transferring dockerfile: 246B                                                                                                                                     0.0s
 => ERROR [internal] load metadata for ghcr.io/cross-rs/x86_64-unknown-linux-gnu:0.2.5                                                                                   1.5s
------
 > [internal] load metadata for ghcr.io/cross-rs/x86_64-unknown-linux-gnu:0.2.5:
------
Dockerfile.x86_64-unknown-linux-gnu-custom:2
--------------------
   1 |     
   2 | >>>                 FROM ghcr.io/cross-rs/x86_64-unknown-linux-gnu:0.2.5
   3 |                     ARG CROSS_DEB_ARCH=
   4 |                     ARG CROSS_CMD
--------------------
ERROR: failed to solve: ghcr.io/cross-rs/x86_64-unknown-linux-gnu:0.2.5: failed to resolve source metadata for ghcr.io/cross-rs/x86_64-unknown-linux-gnu:0.2.5: no match for platform in manifest: not found

View build details: docker-desktop://dashboard/build/orbstack/orbstack/okqylnx30ifvicoynlk4ymqzr
Error: 
   0: could not run container
   1: when building custom image
   2: when pre-building
   3: `docker build --label 'org.cross-rs.for-cross-target=x86_64-unknown-linux-gnu' --label 'org.cross-rs.workspace_root=/Users/rongts/hello' --tag cross-custom-hello:x86_64-unknown-linux-gnu-fd9ec-pre-build --build-arg 'CROSS_CMD=dpkg --add-architecture $CROSS_DEB_ARCH
      apt-get update && apt-get --assume-yes install libssl-dev:$CROSS_DEB_ARCH' --build-arg 'CROSS_DEB_ARCH=amd64' --file /Users/rongts/hello/target/x86_64-unknown-linux-gnu/Dockerfile.x86_64-unknown-linux-gnu-custom /Users/rongts/hello` failed with exit status: 1

Note: CROSS_CMD=dpkg --add-architecture $CROSS_DEB_ARCH
apt-get update && apt-get --assume-yes install libssl-dev:$CROSS_DEB_ARCH
```

æˆ‘æ“¦è®·ï¼ï¼

ä»”ç»†çœ‹é”™è¯¯

```bash
hello git:(master) âœ— cross build --target x86_64-unknown-linux-gnu
[cross] warning: found unused key(s) in Cross configuration:
 > build.zig
[+] Building 2.6s (2/2) FINISHED                                                                                                                              docker:orbstack
 => [internal] load build definition from Dockerfile.x86_64-unknown-linux-gnu-custom                                                                                     0.0s
 => => transferring dockerfile: 246B                                                                                                                                     0.0s
 => ERROR [internal] load metadata for ghcr.io/cross-rs/x86_64-unknown-linux-gnu:0.2.5                                                                                   2.5s
------
 > [internal] load metadata for ghcr.io/cross-rs/x86_64-unknown-linux-gnu:0.2.5:
------
Dockerfile.x86_64-unknown-linux-gnu-custom:2
--------------------
   1 |     
   2 | >>>                 FROM ghcr.io/cross-rs/x86_64-unknown-linux-gnu:0.2.5
   3 |                     ARG CROSS_DEB_ARCH=
   4 |                     ARG CROSS_CMD
--------------------
ERROR: failed to solve: ghcr.io/cross-rs/x86_64-unknown-linux-gnu:0.2.5: failed to resolve source metadata for ghcr.io/cross-rs/x86_64-unknown-linux-gnu:0.2.5: no match for platform in manifest: not found 

View build details: docker-desktop://dashboard/build/orbstack/orbstack/ra8za4nikly8u2uu1maqbjxfd
Error: 
   0: could not run container
   1: when building custom image
   2: when pre-building
   3: `docker build --label 'org.cross-rs.for-cross-target=x86_64-unknown-linux-gnu' --label 'org.cross-rs.workspace_root=/Users/rongts/hello' --tag cross-custom-hello:x86_64-unknown-linux-gnu-fd9ec-pre-build --build-arg 'CROSS_CMD=dpkg --add-architecture $CROSS_DEB_ARCH
      apt-get update && apt-get --assume-yes install libssl-dev:$CROSS_DEB_ARCH' --build-arg 'CROSS_DEB_ARCH=amd64' --file /Users/rongts/hello/target/x86_64-unknown-linux-gnu/Dockerfile.x86_64-unknown-linux-gnu-custom /Users/rongts/hello` failed with exit status: 1

Note: CROSS_CMD=dpkg --add-architecture $CROSS_DEB_ARCH
apt-get update && apt-get --assume-yes install libssl-dev:$CROSS_DEB_ARCH
```

ä»”ç»†çœ‹é”™è¯¯æ²¡æœ‰ `m1` å¹³å°çš„é•œåƒ

```bash
âœ  hello git:(master) âœ— docker manifest inspect ghcr.io/cross-rs/aarch64-unknown-linux-gnu:0.2.5
{
   "schemaVersion": 2,
   "mediaType": "application/vnd.oci.image.index.v1+json",
   "manifests": [
      {
         "mediaType": "application/vnd.oci.image.manifest.v1+json",
         "size": 3716,
         "digest": "sha256:9e5d86740280e021e5f372afcad2eda7367676f33ec40085b49ee88a2652cfe5",
         "platform": {
            "architecture": "amd64",
            "os": "linux"
         }
      },
      {
         "mediaType": "application/vnd.oci.image.manifest.v1+json",
         "size": 566,
         "digest": "sha256:8fc00e4231dfdca09dafab72f9e0cf3f1243dbc87667fe39c4d5d3d0148b212d",
         "platform": {
            "architecture": "unknown",
            "os": "unknown"
         }
      }
   ]
}
```

æœç„¶ä»–æ˜¯ amd64 å°±æ˜¯x86æ¶æ„çš„

ğŸ§â€â™€ï¸è§£å†³æ–¹æ¡ˆï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ `cross build --target x86_64-unknown-linux-gnu` å¤±è´¥çš„æ—¶å€™ï¼Œä»–ä¼šåœ¨ target/x86_64-unknown-linux-gnu/Dockerfile.x86_64-unknown-linux-gnu-custom` ç•™ä¸‹ä¸€ä¸ª dockerfile æˆ‘ä»¬ç»™äºˆè¿™ä¸ª docker é‡æ–°ç¼–è¯‘ï¼Œå¦‚ä½•ä½¿ç”¨æˆ‘ä»¬ç¼–è¯‘å¥½çš„é•œåƒè®© `cross` ç»™æˆ‘ä»¬æ‰“åŒ…

target/x86_64-unknown-linux-gnu/Dockerfile.x86_64-unknown-linux-gnu-custom
```Dockerfile
FROM x86_64-unknown-linux-gnu-pre-build:macos
ARG CROSS_DEB_ARCH==
ARG CROSS_CMD
RUN eval "${CROSS_CMD}"
```

```bash
 hello git:(master) âœ— docker build --platform=linux/amd64 \
  --build-arg CROSS_DEB_ARCH=amd64 \
  --build-arg CROSS_CMD="dpkg --add-architecture amd64 && apt-get update && apt-get install --assume-yes libssl-dev:amd64" \
  -f target/x86_64-unknown-linux-gnu/Dockerfile.x86_64-unknown-linux-gnu-custom \
  -t x86_64-unknown-linux-gnu-pre-build:macos \
  /Users/rongts/hello
[+] Building 0.1s (6/6) FINISHED                                                                                            docker:orbstack
 => [internal] load build definition from Dockerfile.x86_64-unknown-linux-gnu-custom                                                   0.0s
 => => transferring dockerfile: 246B                                                                                                   0.0s
 => [internal] load metadata for ghcr.io/cross-rs/x86_64-unknown-linux-gnu:0.2.5                                                       0.0s
 => [internal] load .dockerignore                                                                                                      0.0s
 => => transferring context: 2B                                                                                                        0.0s
 => [1/2] FROM ghcr.io/cross-rs/x86_64-unknown-linux-gnu:0.2.5                                                                         0.0s
 => CACHED [2/2] RUN eval "dpkg --add-architecture amd64 && apt-get update && apt-get install --assume-yes libssl-dev:amd64"           0.0s
 => exporting to image                                                                                                                 0.0s
 => => exporting layers                                                                                                                0.0s
 => => writing image sha256:c20ec5cc1c9d133c66c9d99ac59c706fe5b51c167e62aacb3cde1ec42794cf51                                           0.0s
 => => naming to docker.io/library/aarch64-unknown-linux-gnu-custom-m1:aarch64-unknown-linux-gnu-m1-pre-build                          0.0s

View build details: docker-desktop://dashboard/build/orbstack/orbstack/0x2b1wz6t61dxebctjucwqrjv
```

```bash

âœ  hello git:(master) âœ— docker images                        
REPOSITORY                                       TAG                                         IMAGE ID       CREATED         SIZE
x86_64-unknown-linux-gnu-custom-m1               x86_64-unknown-linux-gnu-m1-pre-
```

 Cross.toml é…ç½®æ–‡ä»¶
```bash
[target.aarch64-unknown-linux-gnu]
image = "cross-custom-hello:aarch64-unknown-linux-gnu-fd9ec-pre-build"
  
[target.x86_64-unknown-linux-gnu]
image = "x86_64-unknown-linux-gnu-pre-build:macos"
```


```æ‰§è¡Œç¼–è¯‘
hello git:(master) âœ— cross build --target x86_64-unknown-linux-gnu
WARNING: The requested image's platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.42s
```

è¿™é‡Œæœ‰ `warning` æä¸æ¸…æ¥šå®¹å™¨æ˜¯å“ªä¸ªå¹³å°, ä¸‹é¢æˆ‘ä»¬åŠ ä¸Šå¹³å°

 ```bash
 hello git:(master) âœ— CROSS_CONTAINER_OPTS="--platform linux/amd64" cross build --target x86_64-unknown-linux-gnu
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.62s
 ```

å®Œç»“ğŸª¸

### Q/A

> **ä¸ºä»€ä¹ˆåœ¨armä¸­å¯ä»¥æ‰§è¡Œx86çš„å®¹å™¨?

cross å°±æ˜¯ç”¨ **Docker + QEMU** å°è£…ç›®æ ‡æ¶æ„ç¯å¢ƒï¼Œè®©ä½ åœ¨ä¸åŒæ¶æ„ä¸»æœºä¸Šä¹Ÿèƒ½è½»æ¾ç¼–è¯‘ Rust ç›®æ ‡


